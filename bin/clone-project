#!/usr/bin/env bash

usage() {
   echo "Clone the current project directory to a new project directory with name
'target_dir', renaming elements in files and filenames from 'from' to 'to'.
"
   echo "Usage: $0 target_dir from to"
   echo ""
}

orig_dir=$PWD
dest_dir=$1

if [ $# -eq 1 ]; then
   # Destination directory tail part is the project name
	proj_name=${dest_dir##*/}
elif [ $# -eq 2 ]; then
   # Provided name
	proj_name=$2
else
   usage
   exit -1
fi

echo "PROJECT_NAME $proj_name"

# See 'clean' target in run script
rsync -rv --exclude=.git --exclude=build --exclude=target --exclude=deploy \
      --exclude=.cpcache --exclude=.gradle --exclude=.revision \
      --exclude=.app-name --exclude=.nrepl-port --exclude=.repl-port \
      --exclude=\*pom.xml --exclude=\*.log --exclude=logs . $dest_dir

cd $dest_dir

from=uS-core
to=$proj_name


# Change back to original calling dir before calling 
# rename-projectj in case we have relative dir paths as args.
cd $orig_dir

# Rename contents and file names after project has been copied
$(dirname $0)/rename-project $dest_dir uS-core $proj_name
